<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Churn Prediction</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css?v=1">
</head>
<body class="bg-light">
    <!-- Loading Spinner -->
    <div id="loading-spinner" class="d-none">
        <div class="spinner-overlay">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Processing your prediction...</p>
        </div>
    </div>

    <div class="container py-5">
        <div class="card shadow-lg">
            <div class="card-header bg-primary text-white">
                <h2 class="card-title mb-0 text-center"><i class="fas fa-chart-line me-2"></i>Customer Churn Prediction</h2>
            </div>
            <div class="card-body">
                <form id="predictionForm" method="POST" action="{{ url_for('home') }}" novalidate>
                    <!-- Personal Information Section -->
                    <fieldset class="mb-4">
                        <legend class="fs-5 text-primary border-bottom pb-2">
                            <i class="fas fa-user-circle me-2"></i>Personal Information
                        </legend>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-venus-mars"></i></span>
                                    <select class="form-select" id="gender" name="gender" required>
                                        <option value="" selected disabled>Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                    <div class="invalid-feedback">Please select a gender.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-birthday-cake"></i></span>
                                    <input type="number" class="form-control" id="age" name="age" min="18" max="100" placeholder="Age" required>
                                    <div class="invalid-feedback">Please enter a valid age (18-100).</div>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Account Information Section -->
                    <fieldset class="mb-4">
                        <legend class="fs-5 text-primary border-bottom pb-2">
                            <i class="fas fa-university me-2"></i>Account Information
                        </legend>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                    <input type="number" class="form-control" id="tenure" name="tenure" min="0" placeholder="Tenure (months)" required>
                                    <div class="invalid-feedback">Please enter valid tenure.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-wallet"></i></span>
                                    <input type="number" step="0.01" class="form-control" id="balance" name="balance" placeholder="Account Balance" required>
                                    <div class="invalid-feedback">Please enter valid balance.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-boxes"></i></span>
                                    <input type="number" class="form-control" id="products" name="products" min="1" placeholder="Number of Products" required>
                                    <div class="invalid-feedback">Minimum 1 product required.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-dollar-sign"></i></span>
                                    <input type="number" step="0.01" class="form-control" id="estimated_salary" name="estimated_salary" placeholder="Estimated Salary" required>
                                    <div class="invalid-feedback">Please enter valid salary.</div>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Membership Section -->
                    <fieldset class="mb-4">
                        <legend class="fs-5 text-primary border-bottom pb-2">
                            <i class="fas fa-id-card me-2"></i>Membership Details
                        </legend>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Has Credit Card</label>
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="has_cr_card" id="cr_yes" value="1" required>
                                    <label class="btn btn-outline-primary" for="cr_yes"><i class="fas fa-check me-2"></i>Yes</label>
                                    
                                    <input type="radio" class="btn-check" name="has_cr_card" id="cr_no" value="0">
                                    <label class="btn btn-outline-primary" for="cr_no"><i class="fas fa-times me-2"></i>No</label>
                                </div>
                                <div class="invalid-feedback d-block">Please select an option.</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Is Active Member</label>
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="is_active_member" id="active_yes" value="1" required>
                                    <label class="btn btn-outline-primary" for="active_yes"><i class="fas fa-check me-2"></i>Yes</label>
                                    
                                    <input type="radio" class="btn-check" name="is_active_member" id="active_no" value="0">
                                    <label class="btn btn-outline-primary" for="active_no"><i class="fas fa-times me-2"></i>No</label>
                                </div>
                                <div class="invalid-feedback d-block">Please select an option.</div>
                            </div>
                        </div>
                    </fieldset>

                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg px-5">
                            <i class="fas fa-calculator me-2"></i>Predict Churn
                        </button>
                    </div>
                </form>

                <!-- Prediction Result -->
                {% if prediction is defined %}
                <div class="alert mt-4 text-center {% if prediction == 'Churn' %}alert-danger{% else %}alert-success{% endif %}">
                    <h4 class="alert-heading">
                        {% if prediction == 'Churn' %}
                            <i class="fas fa-exclamation-triangle me-2"></i>High Churn Risk
                        {% else %}
                            <i class="fas fa-check-circle me-2"></i>Low Churn Risk
                        {% endif %}
                    </h4>
                    <strong class="fs-4">{{ prediction }}</strong>
                    <hr>
                    <p class="mb-0">
                        {% if prediction == 'Churn' %}
                            This customer is likely to churn. Consider retention strategies.
                        {% else %}
                            This customer is likely to stay. Continue with current engagement.
                        {% endif %}
                    </p>
                </div>
                {% endif %}
            </div>
            <div class="card-footer text-muted text-center">
                <small>Powered by Machine Learning | {% now 'utc', '%Y' %}</small>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Enhanced Form Validation
        (function() {
            'use strict';
            
            const form = document.getElementById('predictionForm');
            
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                } else {
                    // Show loading spinner
                    document.getElementById('loading-spinner').classList.remove('d-none');
                }
                
                form.classList.add('was-validated');
            }, false);
            
            // Add input masking for better UX
            document.getElementById('balance').addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');
            });
            
            document.getElementById('estimated_salary').addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');
            });
        })();
    </script>
</body>
</html>